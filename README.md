# 币安期货自动交易系统

基于 Next.js 16 的加密货币日内交易系统，支持策略回测和币安期货自动交易功能。

## 功能特性

- ✅ **15分钟趋势过滤 + 5分钟回调进场**策略
- ✅ 支持多合约同时监控
- ✅ 分段止盈策略（1R平50%，2R全平）
- ✅ 移动止损功能（达到1R后止损移动到保本价）
- ✅ 实时K线数据推送（WebSocket）
- ✅ 自动扫描热门合约
- ✅ 支持1-125倍杠杆配置
- ✅ 仅支持币安主网真实交易

## 技术栈

- **前端框架**: Next.js 16 (App Router)
- **UI框架**: React 19 + Tailwind CSS 4
- **图表库**: Lightweight Charts 4.1.1
- **API**: Binance Futures API (Mainnet Only)
- **实时通信**: WebSocket
- **语言**: TypeScript 5

## 系统要求

- Node.js 24.x 或更高版本
- pnpm 包管理器
- 浏览器：Chrome、Edge、Firefox 最新版

## 快速开始

### 1. 克隆项目

```bash
git clone <你的仓库地址>
cd <项目目录>
```

### 2. 安装依赖

```bash
pnpm install
```

### 3. 启动开发服务

```bash
pnpm dev
```

服务将运行在 `http://localhost:5000`

### 4. 访问应用

在浏览器中打开 `http://localhost:5000`

## 使用说明

### 第一步：连接币安账户

1. 在登录页面输入币安 API Key 和 API Secret
2. 点击"连接币安账户"
3. 系统会验证 API 密钥的有效性

**注意**：
- API 密钥仅存储在浏览器本地，不会上传到服务器
- 确保你的 API 密钥有期货交易权限
- 建议在币安 API 设置中限制 IP 白名单

### 第二步：选择监控合约

1. 在"选择监控合约"区域勾选要监控的合约
2. 系统会自动加载热门合约列表（BTCUSDT、ETHUSDT 等）
3. 可以手动搜索其他合约

### 第三步：配置交易参数

在"交易配置"区域设置以下参数：

#### 策略参数
- **EMA Short**: 短周期均线（默认20）
- **EMA Long**: 长周期均线（默认60）
- **RSI Period**: RSI周期（默认14）
- **Volume Period**: 成交量均线周期（默认20）
- **最小趋势距离**: EMA之间的最小距离百分比（默认0.15%）

#### 交易配置
- **杠杆**: 交易杠杆倍数（1-125倍，默认3倍）
- **止损比例**: 止损距离百分比（默认0.5%）
- **止盈比例**: 简单止盈比例（默认1.5%）
- **仓位大小**: 每次交易使用账户资金的百分比（默认10%）
- **最大持仓数**: 同时持有的最大合约数量（默认5个）
- **每日交易限制**: 每日最大交易次数（默认10笔）

#### 平仓策略
- **分段止盈**: 1R平50%，2R全平（推荐）
- **移动止损**: 达到1R后移动止损价格
- **移动到保本价**: 达到1R后止损移到入场价
- **反向信号平仓**: 出现反向信号时自动平仓

### 第四步：开始监控

1. 点击"开始监控"按钮
2. 系统会连接 WebSocket 并开始接收实时数据
3. 在"实时交易信号"区域查看检测到的信号

### 第五步：开启自动交易（可选）

⚠️ **警告：自动交易会使用真实资金，请谨慎使用！**

1. 勾选"自动交易"复选框
2. 系统会弹出警告对话框，确认后开启
3. 开启后，系统会自动执行符合条件的交易

#### 自动扫描功能

1. 勾选"自动扫描所有合约"开关
2. 系统会每5分钟自动扫描热门合约
3. 也可以点击"立即扫描"按钮手动触发
4. 在"扫描日志"区域查看扫描进度和结果

## 策略说明

### 15分钟趋势过滤

系统首先在15分钟K线图上判断趋势方向：
- **多头条件**：EMA20 > EMA60，当前价格 > EMA20，成交量 > 平均成交量
- **空头条件**：EMA20 < EMA60，当前价格 < EMA20，成交量 > 平均成交量
- **趋势距离**：EMA20 和 EMA60 之间的距离必须超过 `最小趋势距离`

### 5分钟回调进场

在确认趋势方向后，在5分钟K线图上寻找进场点：
- **做多进场**：价格回踩EMA20或EMA60后重新站上，且RSI上升
- **做空进场**：价格反弹EMA20或EMA60后重新跌破，且RSI下降

### 分段止盈策略

- **1R（第一止盈位）**：平50%仓位
- **2R（第二止盈位）**：平剩余50%仓位
- **R值说明**：1R = 止损距离（如止损0.5%，1R = 价格移动0.5%）

### 移动止损策略

- 达到1R后，止损价格开始随价格移动
- 开启"移动到保本价"后，止损会移动到入场价
- 锁定已实现的利润，防止回撤过大

## 风险提示

1. ⚠️ 本系统仅支持币安主网真实交易，不提供测试网或模拟交易
2. ⚠️ 自动交易会使用真实资金，请务必先在手动模式下测试
3. ⚠️ 数字货币交易存在高风险，请根据自己的风险承受能力使用
4. ⚠️ 建议使用较小的仓位和杠杆开始测试
5. ⚠️ 请妥善保管你的 API 密钥，不要泄露给他人
6. ⚠️ 系统不保证盈利，仅供学习和研究使用

## 常见问题

### Q1: API 签名验证错误(-1022)

**解决方法**：
1. 检查 API Key 和 Secret 是否正确（不要有多余空格）
2. 确认系统时间是否准确（Windows系统自动同步时间）
3. 在币安 API 设置中限制 IP 白名单为你的公网IP
4. 重新生成 API 密钥

### Q2: 信号不显示

**解决方法**：
1. 确认 WebSocket 连接是否正常（查看浏览器控制台）
2. 检查是否已选择监控合约
3. 确认策略参数设置合理
4. 查看"扫描日志"了解信号检测的详细原因

### Q3: 自动扫描卡死

**解决方法**：
1. 点击"立即扫描"按钮手动触发
2. 查看扫描日志了解具体原因
3. 检查网络连接是否正常
4. 减少监控的合约数量

### Q4: 订单执行失败

**解决方法**：
1. 检查账户余额是否充足
2. 确认合约是否有足够的流动性
3. 检查杠杆设置是否正确
4. 查看交易记录了解失败原因

## 项目结构

```
.
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   └── binance/
│   │   │       ├── balance/route.ts      # 获取账户余额
│   │   │       ├── positions/route.ts    # 获取持仓信息
│   │   │       ├── orders/route.ts       # 获取订单列表
│   │   │       ├── order/route.ts        # 执行交易订单
│   │   │       └── leverage/route.ts     # 设置杠杆倍数
│   │   ├── page.tsx                       # 主页面
│   │   └── layout.tsx                     # 布局组件
│   └── components/
│       └── BinanceAutoTrader.tsx         # 主交易组件
├── public/                                # 静态资源
├── package.json                           # 项目依赖
├── tsconfig.json                          # TypeScript配置
└── .coze                                  # 项目配置（沙箱环境）
```

## 开发说明

### 构建项目

```bash
pnpm build
```

### 生产环境部署

```bash
pnpm start
```

### 类型检查

```bash
pnpm tsc --noEmit
```

## 更新日志

### v1.0.0 (2025-01-08)
- ✅ 实现15分钟趋势过滤 + 5分钟回调进场策略
- ✅ 支持分段止盈和移动止损
- ✅ 新增杠杆设置功能（1-125倍）
- ✅ 优化信号检测，显示详细原因
- ✅ 修复自动扫描卡死问题
- ✅ 优化 WebSocket 数据同步
- ✅ 移除测试网支持，仅支持主网真实交易

## 许可证

本项目仅供学习和研究使用。

## 免责声明

本软件仅供学习和研究目的，不构成任何投资建议。使用本软件进行交易的所有风险由用户自行承担。开发者不对任何损失负责。

## 联系方式

如有问题或建议，请提交 Issue 或 Pull Request。

---

**祝您交易顺利！** 📈
