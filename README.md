# 币安期货自动交易系统

基于 Next.js 16 的加密货币日内交易系统，支持策略回测和币安期货自动交易功能。

## ✨ 功能特性

### 核心功能
- ✅ **15分钟趋势过滤 + 5分钟回调进场**策略
- ✅ 支持多合约同时监控
- ✅ 分段止盈策略（1R平50%，2R全平）
- ✅ 移动止损功能（达到1R后止损移动到保本价）
- ✅ 实时K线数据推送（WebSocket）
- ✅ 自动扫描热门合约
- ✅ 支持1-125倍杠杆配置
- ✅ 仅支持币安主网真实交易

### 平台支持
- 🌐 **Web 应用**：支持电脑、手机、平板访问
- 📱 **响应式设计**：自动适配各种屏幕尺寸
- 🎨 **深色主题**：保护视力，节省电量
- ⚡ **实时数据**：WebSocket 实时推送交易信号
- 🔒 **本地存储**：API 密钥存储在浏览器本地

## 🚀 快速部署

### 云端部署（推荐）

#### Vercel 部署（免费）

```bash
# 1. 安装 Vercel CLI
npm i -g vercel

# 2. 登录并部署
vercel login
vercel --prod
```

或者直接在 [vercel.com](https://vercel.com) 上导入 GitHub 仓库。

详细步骤请查看 [云端部署指南](CLOUD_DEPLOYMENT_GUIDE.md)

### 本地开发

#### 1. 克隆项目

```bash
git clone <你的仓库地址>
cd <项目目录>
```

#### 2. 安装依赖

```bash
pnpm install
```

#### 3. 启动开发服务

```bash
pnpm dev
```

服务将运行在 `http://localhost:5000`

#### 4. 访问应用

在浏览器中打开 `http://localhost:5000`

## 💻 技术栈

### 前端
- **框架**: Next.js 16 (App Router)
- **UI**: React 19 + Tailwind CSS 4
- **图表**: Lightweight Charts 4.1.1
- **语言**: TypeScript 5

### 后端
- **API**: Next.js API Routes
- **通信**: WebSocket
- **集成**: Binance Futures API (Mainnet)

### 部署
- **平台**: Vercel / Railway / Docker
- **协议**: HTTPS 自动配置
- **CDN**: 全球节点加速

## 📱 多端使用

### 电脑端
- 使用 Chrome、Edge、Firefox 等现代浏览器
- 访问应用 URL

### 手机端
- 在手机浏览器访问应用 URL
- 支持触摸操作
- 推荐添加到主屏幕使用（像原生应用）

详细说明请查看 [移动端使用指南](MOBILE_USER_GUIDE.md)

## 📖 使用说明

### 第一步：连接币安账户

1. 在登录页面输入币安 API Key 和 API Secret
2. 点击"连接币安账户"
3. 系统会验证 API 密钥的有效性

**重要提示**：
- ✅ API 密钥仅存储在浏览器 localStorage，不会上传到服务器
- ✅ 每个用户需配置自己的 API 密钥
- ⚠️ 确保你的 API 密钥有期货交易权限
- ⚠️ 建议在币安 API 设置中限制 IP 白名单

### 第二步：选择交易策略

系统内置了策略管理器，支持多种策略：

1. **15分钟趋势 + 5分钟回调**（默认）
   - 适合趋势跟踪交易
   - 自动识别趋势方向
   - 等待回调入场

未来可扩展更多策略...

### 第三步：配置交易参数

#### 策略参数
- **EMA Short**: 短周期均线（默认20）
- **EMA Long**: 长周期均线（默认60）
- **RSI Period**: RSI周期（默认14）
- **Volume Period**: 成交量均线周期（默认20）
- **最小趋势距离**: EMA之间的最小距离百分比（默认0.15%）

#### 交易配置
- **杠杆**: 交易杠杆倍数（1-125倍，默认3倍）
- **止损比例**: 止损距离百分比（默认0.5%）
- **止盈比例**: 简单止盈比例（默认1.5%）
- **仓位大小**: 每次交易使用账户资金的百分比（默认10%）
- **最大持仓数**: 同时持有的最大合约数量（默认5个）
- **每日交易限制**: 每日最大交易次数（默认10笔）

#### 平仓策略
- **分段止盈**: 1R平50%，2R全平（推荐）
- **移动止损**: 达到1R后移动止损价格
- **移动到保本价**: 达到1R后止损移到入场价
- **反向信号平仓**: 出现反向信号时自动平仓

### 第四步：开始监控

1. 在"选择监控合约"区域勾选要监控的合约
2. 点击"开始监控"按钮
3. 系统会连接 WebSocket 并开始接收实时数据
4. 在"实时交易信号"区域查看检测到的信号

### 第五步：开启自动交易（可选）

⚠️ **警告：自动交易会使用真实资金，请谨慎使用！**

1. 勾选"自动交易"复选框
2. 系统会弹出警告对话框，确认后开启
3. 开启后，系统会自动执行符合条件的交易

#### 自动扫描功能

1. 勾选"自动扫描所有合约"开关
2. 系统会每5分钟自动扫描热门合约
3. 也可以点击"立即扫描"按钮手动触发
4. 在"扫描日志"区域查看扫描进度和结果

## 📊 策略说明

### 15分钟趋势过滤

系统首先在15分钟K线图上判断趋势方向：
- **多头条件**：EMA20 > EMA60，当前价格 > EMA20，成交量 > 平均成交量
- **空头条件**：EMA20 < EMA60，当前价格 < EMA20，成交量 > 平均成交量
- **趋势距离**：EMA20 和 EMA60 之间的距离必须超过 `最小趋势距离`

### 5分钟回调进场

在确认趋势方向后，在5分钟K线图上寻找进场点：
- **做多进场**：价格回踩EMA20或EMA60后重新站上，且RSI上升
- **做空进场**：价格反弹EMA20或EMA60后重新跌破，且RSI下降

### 分段止盈策略

- **1R（第一止盈位）**：平50%仓位
- **2R（第二止盈位）**：平剩余50%仓位
- **R值说明**：1R = 止损距离（如止损0.5%，1R = 价格移动0.5%）

### 移动止损策略

- 达到1R后，止损价格开始随价格移动
- 开启"移动到保本价"后，止损会移动到入场价
- 锁定已实现的利润，防止回撤过大

## ⚠️ 风险提示

1. ⚠️ 本系统仅支持币安主网真实交易，不提供测试网或模拟交易
2. ⚠️ 自动交易会使用真实资金，请务必先在手动模式下测试
3. ⚠️ 数字货币交易存在高风险，请根据自己的风险承受能力使用
4. ⚠️ 建议使用较小的仓位和杠杆开始测试
5. ⚠️ 请妥善保管你的 API 密钥，不要泄露给他人
6. ⚠️ 系统不保证盈利，仅供学习和研究使用

## 🛠️ 项目结构

```
.
├── src/
│   ├── app/                      # Next.js App Router
│   │   ├── api/                  # API Routes
│   │   │   └── binance/          # 币安 API 集成
│   │   ├── layout.tsx            # 根布局
│   │   ├── page.tsx              # 主页面
│   │   └── globals.css           # 全局样式
│   ├── components/               # React 组件
│   │   ├── BinanceAutoTrader.tsx # 自动交易主组件
│   │   ├── CryptoBacktestTool.tsx # 回测工具
│   │   ├── StrategySelector.tsx  # 策略选择器
│   │   └── CandlestickChart.tsx  # K线图表
│   ├── strategies/               # 交易策略
│   │   └── EMA15mTrend5mPullbackStrategy.ts
│   ├── types/                    # TypeScript 类型定义
│   │   └── strategy.ts
│   └── utils/                    # 工具函数
│       └── strategyManager.ts    # 策略管理器
├── package.json                  # 项目配置
├── tsconfig.json                 # TypeScript 配置
├── next.config.ts                # Next.js 配置
├── vercel.json                   # Vercel 部署配置
├── railway.toml                  # Railway 部署配置
└── README.md                     # 项目说明
```

## ❓ 常见问题

### Q1: API 签名验证错误(-1022)

**解决方法**：
1. 检查 API Key 和 Secret 是否正确（不要有多余空格）
2. 确认系统时间是否准确
3. 在币安 API 设置中限制 IP 白名单
4. 重新生成 API 密钥

详细说明请查看 [API 错误排查](API_400_ERROR_TROUBLESHOOTING.md)

### Q2: 信号不显示

**解决方法**：
1. 确认 WebSocket 连接是否正常（查看浏览器控制台）
2. 检查是否已选择监控合约
3. 确认策略参数设置合理
4. 查看"扫描日志"了解信号检测的详细原因

### Q3: 自动扫描卡死

**解决方法**：
1. 点击"立即扫描"按钮手动触发
2. 查看扫描日志了解具体原因
3. 检查网络连接是否正常
4. 减少监控的合约数量

### Q4: 移动端无法访问

**解决方法**：
1. 确保使用 HTTPS 访问
2. 使用现代浏览器（Chrome、Safari）
3. 清除浏览器缓存
4. 查看移动端使用指南

## 📚 文档

- [云端部署指南](CLOUD_DEPLOYMENT_GUIDE.md) - Vercel/Railway/Docker 部署
- [移动端使用指南](MOBILE_USER_GUIDE.md) - 手机/平板使用说明
- [币安交易指南](BINANCE_TRADING_GUIDE.md) - 交易功能详解
- [自动交易测试指南](AUTO_TRADING_TEST_GUIDE.md) - 测试步骤
- [API 错误排查](API_400_ERROR_TROUBLESHOOTING.md) - 常见 API 问题

## 🔗 相关链接

- [Next.js 文档](https://nextjs.org/docs)
- [币安 API 文档](https://binance-docs.github.io/apidocs/futures/cn/)
- [React 文档](https://react.dev)
- [Tailwind CSS](https://tailwindcss.com)

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📞 技术支持

如有问题，请在 GitHub 上提交 Issue。

---

**⚠️ 重要提示**：本系统仅供学习和研究使用，数字货币交易存在高风险，请谨慎投资！
